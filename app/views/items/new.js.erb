var link = $("#url");
var text = $(link).val();
var loading = $('<div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div>');
// send url to service for parsing

$("#urlb").addClass("disabled").attr("href", "#");
$(".modal-body form").hide().after(loading);

$.ajax('/linkpreview', {
  type: 'POST',
  dataType:'json',
  data: { url: text },
  success: function(data, textStatus, jqXHR) {
  	$("#linkpreview").hide().after('<%= j render("item_fields") %>').after('<%= j render("carousel") %>');
    $('label[for="item_image"]').hide();
    $('label[for="item_remote_image_url"]').hide();
    $("#item_image").hide();
    // $("#item_remote_image_url").hide();
    var newHTML = [];
    $.each(data['img'], function(index, value) {
      newHTML.push('<div class="item"><img src="' + value + '"></div>')
    });
    $(".carousel-inner").html(newHTML.join(""));
    $("#item_title").val(data['title']);
    $("#item_link").val(data['url']);
    // $("#item_remote_image_url").val(data['img']);
    $("#commit").on('hover', function() {
      $("#item_remote_image_url").val($("#imgPreview .active img").attr("src"))
    });
    $("#commit").on('click', function() {
      // $("#item_remote_image_url").val($("#imgPreview .active img").attr("src"))
      $(this).addClass("disabled").attr("href", "#");
    })
  },
  error: function() { alert("Something went wrong. Please try again."); 
    $("#urlb").removeClass("disabled").attr("href", "/items/new");
    $(".modal-body form").show();
    $(".progress").hide();
  }
}); 
