var link = $("#url");
var text = $(link).val();
var loading = $('<span class="loading"></span>')
// send url to service for parsing

$("#urlb").addClass("disabled").attr("href", "#")
$(".modal-body form").hide().after(loading)

$.ajax('/linkpreview', {
  type: 'POST',
  dataType:'json',
  data: { url: text },
  success: function(data, textStatus, jqXHR) {
  	$("#linkpreview").hide().after('<%= j render("item_fields") %>');
    $("#item_title").val(data['title']);
    $("#item_link").val(data['url']);
    $("#item_remote_image_url").val(data['img']);
    $("#commit").on('click', function() {
      $(this).addClass("disabled").attr("href", "#")
    })
  },
  error: function() { alert("Something went wrong. Please try again."); 
    $("#urlb").removeClass("disabled").attr("href", "/items/new");
    $(".modal-body form").show();
    $(".loading").hide();
  }
}); 
